<!DOCTYPE html>

<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

    </head>
    <body style="margin: 0px;">
        <div style="padding-top: 8px;padding-left:8px;">
            <div id="mainDiv" style="border: 5px solid black; height:500px; width:700px;position: relative;"></div>

        </div>
        <script>

            var takenSpots = [];
            var mainDiv = document.getElementById("mainDiv");
            var PacmanWidth = 20;
            var Pacman_step = 3;
            var Br1 = [{x: 10, y: 10}, {x: 600, y: 10}, {x: 10, y: 20}, {x: 600, y: 20}];
            var pacman = [{x: 10, y: 10}, {x: 30, y: 10}, {x: 10, y: 30}, {x: 30, y: 30}];
            var enemies = [{x: 10, y: 10}, {x: 30, y: 10}, {x: 10, y: 30}, {x: 30, y: 30}];
            var enemiesWidth = 20;
            var enemies_step = 6;
            var pacmanPosition = {x: 0, y: 0};
            var enemiesPosition = {x: 480, y: 680};
            /* function Pacman(){
             
             this.pacman = [{x:10,y:10},{x:30,y:10},{x:10,y:30},{x:30,y:30}];
             this.PacmanWidth = 20;
             this.Pacman_step = 3;
             function drawPacman(Br, parentDiv,color,top,left){
             var div = draw(Br, parentDiv,color,top,left);
             div.style.border = "1px solid yellow";
             div.style.borderRadius = "10px";
             return div;
             }
             var packmenDiv = drawPacman(this.pacman,mainDiv,"yellow",0,0);
             
             };*/
            function moveEnemy() {


                if (positionEnemy.y > positionPacman.y)
                {//if top
                    while (positionEnemy.y > positionPacman.y)
                    {
                        if (positionEnemy.y > 0 && findIfMoveUpDown(positionEnemy.x, positionEnemy.y, enemyWidth))
                        {
                            positionEnemy.y = positionEnemy.y - 6;
                            packmenDiv.style.left = left + "px";//move up
                        } else if (positionEnemy.x > positionPacman.x) {

                            if (positionEnemy.x > 0 && findIfMoveLeftRight(positionEnemy.x, positionEnemy.y, enemyWidth))

                            {
                                positionEnemy.x = positionEnemy.x - 6;
                                moveEnemy();//move left
                            }
                        }//end of else if left
                        else if (positionEnemy.x < 680 && positionEnemy.x < positionPacman.x) {

                            if (findIfMoveLeftRight(positionEnemy.x, positionEnemy.y, enemyWidth))
                            {
                                positionEnemy.x = positionEnemy.x + 6;
                                moveEnemy();//move right

                            }//end of if can move right   
                        }//end of else if right
                    }//end of while
                    //if go down
                    //if if go right or left

                }//end of if
            }//end of function

 









            function creatSpotKey(x, y) {
                var strSpot = x + "," + y;
                return strSpot;
            }
            function mapSpot() {
                for (var i = 0; i < barrierArray.length; i++) {
                    var left = barrierArray[i].style.left.split("px")[0] * 1;
                    var top = barrierArray[i].style.top.split("px")[0] * 1;
                    var width = barrierArray[i].style.width.split("px")[0] * 1;
                    var height = barrierArray[i].style.height.split("px")[0] * 1;
                    for (var y = top; y < top + height; y++) {
                        for (var x = left; x < left + width; x++) {
                            var key = creatSpotKey(x, y);
                            takenSpots[key] = 1;
                        }
                    }

                }
            }

            function findIfMoveLeftRight(x,y,PacmanWidth) {
                for (var i = y; i < y + PacmanWidth; i++) {
                    if (takenSpots[[creatSpotKey(x, i)]]) {

                        return false;
                    }
                }
                return true;
            }

            function findIfMoveUpDown(x,y,PacmanWidth) {
                for (var i = x; i < x + PacmanWidth; i++) {
                    if (takenSpots[[creatSpotKey(i, y)]]) {

                        return false;
                    }
                }
                return true;
            }


            function findIfTaken(x, y) {

                return takenSpots[creatSpotKey(x, y)]; //true or false
            }

            function draw(Br,parentDiv,color) {
                var div = document.createElement("div");
                div.style.height = (Br[2].y - Br[0].y) + 'px';
                div.style.width = (Br[1].x - Br[0].x) + 'px';
                div.style.position = "absolute";
                div.style.backgroundColor = color;
                parentDiv.appendChild(div);
                return div;
            }

            function positionByTop(div,top,left) {
                div.style.top = top + 'px';
                div.style.left = left + 'px';
            }
            
            function positionByBottom(div,bottom,right) {
                div.style.bottom = bottom + 'px';
                div.style.right = right + 'px';
            }
            
            function drawgameCharcters(Br,parentDiv,color,top,left) {
                var div = draw(Br, parentDiv, color, top, left);
                div.style.border = "1px solid " + color;
                div.style.borderRadius = "10px";
                return div;
            }

            var packmenDiv = drawgameCharcters(pacman, mainDiv, "yellow", 0, 0);
            positionByTop(packmenDiv, 0, 0);
            var packmenEnemy = drawgameCharcters(pacman, mainDiv, "red", 0, 0);
            positionByBottom(packmenEnemy, 0, 0);
            
            var barrierArray = [];
            barrierArray[0] = draw(Br1, mainDiv, "red");
            positionByTop(barrierArray[0], 30, 0);
            barrierArray[1] = draw(Br1, mainDiv, "red");
            positionByTop(barrierArray[1], 70, 110);
            barrierArray[2] = draw(Br1, mainDiv, "red");
            positionByTop(barrierArray[2], 110, 0);
            barrierArray[3] = draw(Br1, mainDiv, "red");
            positionByTop(barrierArray[3], 30, 0);
            barrierArray[4] = draw(Br1, mainDiv, "red");
            positionByTop(barrierArray[4], 190, 0);
            barrierArray[5] = draw(Br1, mainDiv, "red");
            positionByTop(barrierArray[5], 230, 110);
            barrierArray[6] = draw(Br1, mainDiv, "red");
            positionByTop(barrierArray[6], 270, 110);
            barrierArray[7] = draw(Br1, mainDiv, "red");
            positionByTop(barrierArray[7], 310, 0);
            barrierArray[8] = draw(Br1, mainDiv, "red");
            positionByTop(barrierArray[8], 350, 40);
            barrierArray[9] = draw(Br1, mainDiv, "red");
            positionByTop(barrierArray[9], 390, 110);
            barrierArray[10] = draw(Br1, mainDiv, "red");
            positionByTop(barrierArray[10], 430, 0);
            barrierArray[11] = draw(Br1, mainDiv, "red");
            positionByTop(barrierArray[11], 470, 110);
            window.addEventListener("keypress", movePacman, false);
            
            mapSpot();
            function movePacman(event) {
                var code = event.keyCode;
                var left = packmenDiv.style.left.split("px")[0] * 1;
                var top = packmenDiv.style.top.split("px")[0] * 1;
                if (code === 97 && left > 0 && findIfMoveLeftRight(left - Pacman_step, top, PacmanWidth))
                {
                    left = left - Pacman_step; //move 3 px left
                    packmenDiv.style.left = left + "px";
                } else if (code === 100 && left < 680 && findIfMoveLeftRight(left + PacmanWidth + Pacman_step, top, PacmanWidth)) {
                    left = left + 3; //move 3 px right
                    packmenDiv.style.left = left + "px";
                } else if (code === 119 && top > 0 && findIfMoveUpDown(left, top - Pacman_step, PacmanWidth)) {
                    top = top - 3; //move 3 px up
                    packmenDiv.style.top = top + "px";
                } else if (code === 120 && top < 490 && findIfMoveUpDown(left, top + PacmanWidth + Pacman_step, PacmanWidth)) {
                    top = top + 3; //move 3 px down
                    packmenDiv.style.top = top + "px";
                }



            }

        </script>   

    </body>
</html>
